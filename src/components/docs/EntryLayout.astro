---
import BaseLayout from "@components/base/BaseLayout.astro";
import type { DocsEntry, MenuItem } from "@/types";
import DocBrowser from "@components/docs/Browser.astro";
import TableOfContents from "@components/common/TableOfContents.astro";
import { render } from "astro:content";
import EntryHeader from "@components/common/EntryHeader.astro";

interface Props {
  entry: DocsEntry;
  browserMenu: MenuItem[];
}

const { entry, browserMenu } = Astro.props;
const { Content, headings } = await render(entry);
const { title, description, hideNav, hideToc, image } = entry.data;

const globalHideNav = false;
const globalHideToc = false;
const tocDepth = 3;

const actuallyHideNav = hideNav || globalHideNav;
const actuallyHideToc = hideToc || globalHideToc || headings.filter(h => h.depth <= tocDepth).length === 0;

let articleClass = "";
let navClass = "";
let tocClass = "";

if (actuallyHideNav && actuallyHideToc) {
  navClass = "hidden";
  articleClass = "w-full";
  tocClass = "hidden";
} else if (!actuallyHideNav && actuallyHideToc) {
  navClass = "hidden md:flex md:w-1/4 lg:w-1/5";
  articleClass = "w-full md:w-3/4 lg:w-4/5";
  tocClass = "hidden";
} else if (actuallyHideNav && !actuallyHideToc) {
  navClass = "hidden";
  articleClass = "w-full md:w-3/4 lg:w-4/5";
  tocClass = "hidden md:flex md:w-1/4 lg:w-1/5";
} else {
  navClass = "hidden md:flex md:w-1/4 lg:w-1/5";
  articleClass = "w-full md:w-3/4 lg:w-3/5";
  tocClass = "hidden lg:flex lg:w-1/5";
}
---

<BaseLayout title={title} image={image?.src} description={description}>
  <section class="flex container p-4">
    
    <!-- Navegación lateral izquierda -->
    <div class={`max-h-static_sidemenu sticky top-[5rem] mr-4 ${navClass}`}>
      <DocBrowser
        menu={browserMenu}
        currentPage={entry.id.replace("/-index", "")}
      />
    </div>

    <!-- Contenido principal -->
    <div class={`w-full ${articleClass}`}>
      <article>
        <section>
          <!-- Header: Título + Fecha -->
          <EntryHeader entry={entry} showImage showPubDate />

          <!-- Descripción del MD -->
          {description && (
            <p class="mt-2 text-gray-700 dark:text-gray-300 text-base">
              {description}
            </p>
          )}
        </section>

        <!-- Contenido del MD -->
        <section class="content mb-4 glass px-4 rounded-lg">
          <Content />
        </section>
      </article>
    </div>

    <!-- Tabla de contenidos -->
    <div class={`max-h-static_sidemenu sticky top-[5rem] ml-4 ${tocClass}`}>
      <TableOfContents headings={headings} tocDepth={tocDepth} />
    </div>

  </section>
</BaseLayout>
